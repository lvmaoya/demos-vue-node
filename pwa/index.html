<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Demo - Progressive Web App æ¼”ç¤º</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2196F3">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .feature {
            margin-bottom: 25px;
        }
        
        .feature h3 {
            color: #2196F3;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .feature p {
            color: #666;
            margin-bottom: 10px;
        }
        
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .status.online {
            background: #4CAF50;
            color: white;
        }
        
        .status.offline {
            background: #FF5722;
            color: white;
        }
        
        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #1976D2;
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .install-prompt {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .demo-section {
            margin-top: 20px;
        }
        
        .demo-section h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .cache-list {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .cache-item {
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .cache-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ PWA Demo</h1>
            <p>Progressive Web App å®Œæ•´æ¼”ç¤º</p>
        </div>
        
        <div class="install-prompt" id="installPrompt">
            <strong>ğŸ“± å¯ä»¥å®‰è£…æ­¤åº”ç”¨ï¼</strong>
            <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å°†æ­¤PWAå®‰è£…åˆ°æ‚¨çš„è®¾å¤‡ä¸Š</p>
            <button class="btn" id="installBtn">å®‰è£…åº”ç”¨</button>
            <button class="btn" id="dismissBtn" style="background: transparent; color: white; border: 1px solid white;">ç¨åå†è¯´</button>
        </div>
        
        <div class="card">
            <h2>ä»€ä¹ˆæ˜¯ PWAï¼Ÿ</h2>
            <p>Progressive Web Appï¼ˆæ¸è¿›å¼ç½‘ç»œåº”ç”¨ï¼‰æ˜¯ä¸€ç§ç»“åˆäº†ç½‘é¡µå’ŒåŸç”Ÿåº”ç”¨ä¼˜åŠ¿çš„æŠ€æœ¯ã€‚å®ƒå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š</p>
            
            <div class="feature">
                <h3>ğŸ“± å¯å®‰è£…æ€§</h3>
                <p>ç”¨æˆ·å¯ä»¥å°†PWAå®‰è£…åˆ°è®¾å¤‡ä¸»å±å¹•ï¼ŒåƒåŸç”Ÿåº”ç”¨ä¸€æ ·å¯åŠ¨</p>
                <span class="status" id="installableStatus">æ£€æµ‹ä¸­...</span>
            </div>
            
            <div class="feature">
                <h3>ğŸ”„ ç¦»çº¿å·¥ä½œ</h3>
                <p>é€šè¿‡Service Workerç¼“å­˜èµ„æºï¼Œå³ä½¿ç¦»çº¿ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨</p>
                <span class="status" id="offlineStatus">æ£€æµ‹ä¸­...</span>
            </div>
            
            <div class="feature">
                <h3>ğŸ”” æ¨é€é€šçŸ¥</h3>
                <p>æ”¯æŒåå°æ¨é€é€šçŸ¥ï¼Œæå‡ç”¨æˆ·å‚ä¸åº¦</p>
                <span class="status" id="notificationStatus">æ£€æµ‹ä¸­...</span>
            </div>
            
            <div class="feature">
                <h3>ğŸ“¶ ç½‘ç»œçŠ¶æ€æ„ŸçŸ¥</h3>
                <p>èƒ½å¤Ÿæ£€æµ‹ç½‘ç»œçŠ¶æ€å˜åŒ–å¹¶ç›¸åº”è°ƒæ•´è¡Œä¸º</p>
                <span class="status" id="networkStatus">åœ¨çº¿</span>
            </div>
        </div>
        
        <div class="card">
            <h2>PWA åŠŸèƒ½æ¼”ç¤º</h2>
            
            <div class="demo-section">
                <h4>Service Worker æ§åˆ¶</h4>
                <button class="btn" id="registerSW">æ³¨å†Œ Service Worker</button>
                <button class="btn" id="unregisterSW">æ³¨é”€ Service Worker</button>
                <button class="btn" id="updateSW">æ›´æ–°ç¼“å­˜</button>
                <p id="swStatus">Service Worker çŠ¶æ€ï¼šæœªæ³¨å†Œ</p>
            </div>
            
            <div class="demo-section">
                <h4>é€šçŸ¥åŠŸèƒ½</h4>
                <button class="btn" id="requestNotification">è¯·æ±‚é€šçŸ¥æƒé™</button>
                <button class="btn" id="sendNotification" disabled>å‘é€æµ‹è¯•é€šçŸ¥</button>
                <p id="notificationInfo">é€šçŸ¥æƒé™ï¼šæœªè¯·æ±‚</p>
            </div>
            
            <div class="demo-section">
                <h4>ç¼“å­˜ç®¡ç†</h4>
                <button class="btn" id="showCache">æŸ¥çœ‹ç¼“å­˜å†…å®¹</button>
                <button class="btn" id="clearCache">æ¸…é™¤ç¼“å­˜</button>
                <div class="cache-list" id="cacheList" style="display: none;"></div>
            </div>
        </div>
        
        <div class="card">
            <h2>æŠ€æœ¯å®ç°</h2>
            <div class="feature">
                <h3>æ ¸å¿ƒæ–‡ä»¶</h3>
                <ul>
                    <li><strong>manifest.json</strong> - åº”ç”¨æ¸…å•æ–‡ä»¶ï¼Œå®šä¹‰åº”ç”¨å…ƒæ•°æ®</li>
                    <li><strong>sw.js</strong> - Service Workeræ–‡ä»¶ï¼Œå¤„ç†ç¼“å­˜å’Œç¦»çº¿åŠŸèƒ½</li>
                    <li><strong>index.html</strong> - ä¸»é¡µé¢ï¼ŒåŒ…å«PWAåŠŸèƒ½æ¼”ç¤º</li>
                </ul>
            </div>
            
            <div class="feature">
                <h3>å…³é”®æŠ€æœ¯</h3>
                <ul>
                    <li><strong>Service Worker API</strong> - åå°è„šæœ¬ï¼Œå¤„ç†ç½‘ç»œè¯·æ±‚å’Œç¼“å­˜</li>
                    <li><strong>Cache API</strong> - ç¼“å­˜ç®¡ç†ï¼Œå®ç°ç¦»çº¿è®¿é—®</li>
                    <li><strong>Web App Manifest</strong> - åº”ç”¨é…ç½®ï¼Œæ”¯æŒå®‰è£…åˆ°ä¸»å±å¹•</li>
                    <li><strong>Notification API</strong> - æ¨é€é€šçŸ¥åŠŸèƒ½</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        // PWA åŠŸèƒ½å®ç°
        let deferredPrompt;
        let swRegistration;
        
        // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
        function checkSupport() {
            const installableStatus = document.getElementById('installableStatus');
            const offlineStatus = document.getElementById('offlineStatus');
            const notificationStatus = document.getElementById('notificationStatus');
            
            // æ£€æŸ¥Service Workeræ”¯æŒ
            if ('serviceWorker' in navigator) {
                offlineStatus.textContent = 'æ”¯æŒ';
                offlineStatus.className = 'status online';
            } else {
                offlineStatus.textContent = 'ä¸æ”¯æŒ';
                offlineStatus.className = 'status offline';
            }
            
            // æ£€æŸ¥é€šçŸ¥æ”¯æŒ
            if ('Notification' in window) {
                notificationStatus.textContent = 'æ”¯æŒ';
                notificationStatus.className = 'status online';
            } else {
                notificationStatus.textContent = 'ä¸æ”¯æŒ';
                notificationStatus.className = 'status offline';
            }
        }
        
        // ç½‘ç»œçŠ¶æ€ç›‘å¬
        function updateNetworkStatus() {
            const networkStatus = document.getElementById('networkStatus');
            if (navigator.onLine) {
                networkStatus.textContent = 'åœ¨çº¿';
                networkStatus.className = 'status online';
            } else {
                networkStatus.textContent = 'ç¦»çº¿';
                networkStatus.className = 'status offline';
            }
        }
        
        // Service Worker æ³¨å†Œ
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    swRegistration = await navigator.serviceWorker.register('sw.js');
                    document.getElementById('swStatus').textContent = 'Service Worker çŠ¶æ€ï¼šå·²æ³¨å†Œ';
                    console.log('SW registered: ', swRegistration);
                } catch (error) {
                    document.getElementById('swStatus').textContent = 'Service Worker çŠ¶æ€ï¼šæ³¨å†Œå¤±è´¥';
                    console.log('SW registration failed: ', error);
                }
            }
        }
        
        // Service Worker æ³¨é”€
        async function unregisterServiceWorker() {
            if (swRegistration) {
                await swRegistration.unregister();
                document.getElementById('swStatus').textContent = 'Service Worker çŠ¶æ€ï¼šå·²æ³¨é”€';
            }
        }
        
        // æ›´æ–°ç¼“å­˜
        async function updateCache() {
            if (swRegistration) {
                swRegistration.update();
                alert('ç¼“å­˜æ›´æ–°è¯·æ±‚å·²å‘é€');
            }
        }
        
        // è¯·æ±‚é€šçŸ¥æƒé™
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                const notificationInfo = document.getElementById('notificationInfo');
                const sendBtn = document.getElementById('sendNotification');
                
                notificationInfo.textContent = `é€šçŸ¥æƒé™ï¼š${permission}`;
                
                if (permission === 'granted') {
                    sendBtn.disabled = false;
                }
            }
        }
        
        // å‘é€æµ‹è¯•é€šçŸ¥
        function sendTestNotification() {
            if (Notification.permission === 'granted') {
                new Notification('PWA Demo é€šçŸ¥', {
                    body: 'è¿™æ˜¯ä¸€ä¸ªæ¥è‡ªPWAåº”ç”¨çš„æµ‹è¯•é€šçŸ¥ï¼',
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%232196F3"/><text x="50" y="60" text-anchor="middle" fill="white" font-size="30">PWA</text></svg>',
                    tag: 'pwa-demo'
                });
            }
        }
        
        // æ˜¾ç¤ºç¼“å­˜å†…å®¹
        async function showCacheContent() {
            const cacheList = document.getElementById('cacheList');
            const cacheNames = await caches.keys();
            
            if (cacheNames.length === 0) {
                cacheList.innerHTML = '<p>æš‚æ— ç¼“å­˜å†…å®¹</p>';
            } else {
                let html = '<h5>ç¼“å­˜åˆ—è¡¨ï¼š</h5>';
                for (const cacheName of cacheNames) {
                    const cache = await caches.open(cacheName);
                    const requests = await cache.keys();
                    html += `<div class="cache-item"><strong>${cacheName}</strong> (${requests.length} é¡¹)</div>`;
                    requests.forEach(request => {
                        html += `<div class="cache-item" style="padding-left: 20px;">â€¢ ${request.url}</div>`;
                    });
                }
                cacheList.innerHTML = html;
            }
            
            cacheList.style.display = 'block';
        }
        
        // æ¸…é™¤ç¼“å­˜
        async function clearAllCache() {
            const cacheNames = await caches.keys();
            await Promise.all(cacheNames.map(name => caches.delete(name)));
            alert('æ‰€æœ‰ç¼“å­˜å·²æ¸…é™¤');
            document.getElementById('cacheList').style.display = 'none';
        }
        
        // å®‰è£…æç¤ºå¤„ç†
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
            document.getElementById('installableStatus').textContent = 'å¯å®‰è£…';
            document.getElementById('installableStatus').className = 'status online';
        });
        
        // å®‰è£…æŒ‰é’®ç‚¹å‡»
        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
                document.getElementById('installPrompt').style.display = 'none';
            }
        });
        
        // ç¨åå†è¯´æŒ‰é’®
        document.getElementById('dismissBtn').addEventListener('click', () => {
            document.getElementById('installPrompt').style.display = 'none';
        });
        
        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('registerSW').addEventListener('click', registerServiceWorker);
        document.getElementById('unregisterSW').addEventListener('click', unregisterServiceWorker);
        document.getElementById('updateSW').addEventListener('click', updateCache);
        document.getElementById('requestNotification').addEventListener('click', requestNotificationPermission);
        document.getElementById('sendNotification').addEventListener('click', sendTestNotification);
        document.getElementById('showCache').addEventListener('click', showCacheContent);
        document.getElementById('clearCache').addEventListener('click', clearAllCache);
        
        // ç½‘ç»œçŠ¶æ€ç›‘å¬
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            checkSupport();
            updateNetworkStatus();
            registerServiceWorker();
        });
    </script>
</body>
</html>